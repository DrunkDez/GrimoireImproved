// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String      @id @default(cuid())
  email         String      @unique
  name          String?
  passwordHash  String
  characters    Character[]
  rotes         Rote[]      // User's created rotes
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
}

model Character {
  id           String          @id @default(cuid())
  name         String
  faction      String          // Tradition or Technocracy convention
  concept      String?         // Character concept/background
  arete        Int?            // Arete rating (1-10)
  avatar       String?         // Avatar description
  essence      String?         // Dynamic, Pattern, Primordial, Questing
  userId       String
  user         User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  rotes        CharacterRote[]
  createdAt    DateTime        @default(now())
  updatedAt    DateTime        @updatedAt

  @@index([userId])
  @@index([faction])
}

model CharacterRote {
  id          String    @id @default(cuid())
  characterId String
  roteId      String
  character   Character @relation(fields: [characterId], references: [id], onDelete: Cascade)
  rote        Rote      @relation(fields: [roteId], references: [id], onDelete: Cascade)
  notes       String?   @db.Text // Personal notes about how they use this rote
  specialty   Boolean   @default(false) // Is this a specialty rote?
  createdAt   DateTime  @default(now())
  
  @@unique([characterId, roteId])
  @@index([characterId])
  @@index([roteId])
}

model Rote {
  id                String          @id @default(cuid())
  name              String
  tradition         String          // Which tradition/convention it belongs to
  description       String          @db.Text
  spheres           Json            // JSON object with sphere levels
  level             String          // Initiate, Apprentice, Disciple, Adept, Master
  pageRef           String?         // Book page reference
  userId            String?         // Who created this rote (null for admin/default rotes)
  user              User?           @relation(fields: [userId], references: [id], onDelete: SetNull)
  isPublic          Boolean         @default(true) // Public for everyone or private to creator
  characterRotes    CharacterRote[]
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt

  @@index([tradition])
  @@index([level])
  @@index([userId])
  @@index([isPublic])
}

model Merit {
  id          String   @id @default(cuid())
  name        String   @unique
  type        String   // Physical, Social, Mental, Supernatural
  cost        String   // Can be variable like "1-5" or "Special"
  description String   @db.Text
  pageRef     String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([type])
}

model Background {
  id          String   @id @default(cuid())
  name        String   @unique
  cost        String   // Usually "1-5" but can be special
  description String   @db.Text
  pageRef     String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Resource {
  id          String   @id @default(cuid())
  title       String
  type        String   // "Book", "Supplement", "Website", "Video", etc
  description String   @db.Text
  url         String?  // Link to resource
  author      String?  // Creator/author name
  imageUrl    String?  // Optional image/logo
  featured    Boolean  @default(false) // Admin can feature certain resources
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([type])
  @@index([featured])
}

model SiteSettings {
  id                  String   @id @default(cuid())
  key                 String   @unique // Identifier for the setting
  value               String   @db.Text
  updatedAt           DateTime @updatedAt
  
  @@index([key])
}

model MageGroup {
  id                String   @id @default(cuid())
  name              String   @unique // "Akashic Brotherhood", "Iteration X", etc
  slug              String   @unique // URL-friendly: "akashic-brotherhood"
  category          String   // "Tradition", "Technocracy", "Craft"
  description       String   @db.Text // Full description text
  philosophy        String?  @db.Text // Their philosophy/beliefs
  practices         String?  @db.Text // How they practice magic
  organization      String?  @db.Text // How they're organized
  symbolImage       String?  // Path to symbol/icon image
  logoImage         String?  // Path to stylized name logo
  representativeImage String? // Path to representative/header image
  published         Boolean  @default(false) // Control visibility
  sortOrder         Int      @default(0) // For custom ordering
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([category])
  @@index([published])
  @@index([slug])
}
